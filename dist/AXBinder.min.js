var AXBinder=function(){function get_type(O){var typeName;return null!=O&&O==O.window?typeName="window":O&&1==O.nodeType?typeName="element":O&&11==O.nodeType?typeName="fragment":"undefined"==typeof O?typeName="undefined":"[object Object]"==_toString.call(O)?typeName="object":"[object Array]"==_toString.call(O)?typeName="array":"[object String]"==_toString.call(O)?typeName="string":"[object Number]"==_toString.call(O)?typeName="number":"[object NodeList]"==_toString.call(O)?typeName="nodelist":"function"==typeof O&&(typeName="function"),typeName}var _toString=Object.prototype.toString,klass=function(){this.model={},this.view_target=null,this.trigger={}};return klass.prototype.set_model=function(model,view_target){return this.model=model,this.view_target=view_target,this._binding(),this},klass.prototype._binding=function(){var _this=this;this.view_target.find("[data-ax-path]").each(function(){var dom=$(this),data_path=dom.attr("data-ax-path"),val="";try{val=Function("","return this."+data_path+";").call(_this.model)}catch(e){console.log("not found target [model."+data_path+"]")}_this.set_els_value(this,this.tagName.toLowerCase(),this.type.toLowerCase(),val)}),this.view_target.find("[data-ax-path]").bind("change",function(){var i,checked,dom=$(this),data_path=dom.attr("data-ax-path"),origin_value=Function("","return this."+data_path+";").call(_this.model),value_type=get_type(origin_value),setAllow=!0,hasItem=!1,new_value=[];if(("object"==value_type||"array"==value_type)&&(setAllow=!1),"checkbox"==this.type.toLowerCase()){for("array"!=get_type(origin_value)&&(origin_value=[].concat(origin_value)),i=origin_value.length,hasItem=!1,checked=this.checked;i--;)origin_value[i]==this.value&&(hasItem=!0);if(checked)hasItem||origin_value.push(this.value);else{for(i=origin_value.length;i--;)origin_value[i]==this.value||new_value.push(origin_value[i]);origin_value=new_value}Function("val","this."+data_path+" = val;").call(_this.model,origin_value),_this.change(data_path,{el:this,tagname:this.tagName.toLowerCase(),value:origin_value})}else setAllow&&(Function("val","this."+data_path+" = val;").call(_this.model,this.value),_this.change(data_path,{el:this,tagname:this.tagName.toLowerCase(),value:this.value}))})},klass.prototype.set_els_value=function(el,tagname,type,value,data_path){value=[].concat(value);var options,i;if("input"==tagname)if("checkbox"==type||"radio"==type){i=value.length;for(var checked=!1;i--;)el.value===value[i].toString()&&(checked=!0);el.checked=checked}else el.value=value.join("");else if("select"==tagname){for(options=el.options,i=options.length;i--;)for(var vi=value.length;vi--;)options[i].value===value[vi].toString()&&(options[i].selected=!0);window.AXSelect&&$(el).bindSelectSetValue(value[value.length-1])}else"textarea"==tagname&&(el.value=value.join(""));data_path&&this.change(data_path,{el:el,tagname:tagname,value:value})},klass.prototype.set=function(data_path,value){var obj_type,i,_this=this;if(Function("val","this."+data_path+" = val;").call(this.model,value),obj_type=get_type(value),"object"==obj_type)for(var k in value)this.set(data_path+"."+k,value[k]);else if("array"==obj_type)for(this.view_target.find('[data-ax-path="'+data_path+'"]').each(function(){("checkbox"==this.type.toLowerCase()||"radio"==this.type.toLowerCase())&&_this.set_els_value(this,this.tagName.toLowerCase(),this.type.toLowerCase(),value,data_path)}),i=value.length;i--;)this.set(data_path+"["+i+"]",value[i]);else this.view_target.find('[data-ax-path="'+data_path+'"]').each(function(){_this.set_els_value(this,this.tagName.toLowerCase(),this.type.toLowerCase(),value,data_path)});return this},klass.prototype.get=function(data_path){return"undefined"==typeof data_path?this.model:Function("","return this."+data_path+";").call(this.model)},klass.prototype.getAll=function(){return this.get()},klass.prototype.set_onchange=function(data_path,callBack){return this.trigger[data_path]=callBack,this},klass.prototype.change=function(data_path,that){var callBack=this.trigger[data_path];callBack&&callBack.call(that,that)},klass.prototype.update=function(){},new klass}();